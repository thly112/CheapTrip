{"ast":null,"code":"var _jsxFileName = \"D:\\\\hackathon\\\\CheapTrip\\\\front-end\\\\src\\\\pages\\\\AssistantPage.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState } from 'react';\nimport { askGemini } from '../services/aiService';\nimport MapRoute from '../components/MapRoute';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AssistantPage = () => {\n  _s();\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [places, setPlaces] = useState([]);\n  const handleSend = async () => {\n    if (!input.trim() || loading) return;\n    const userMessage = {\n      role: 'user',\n      parts: [{\n        text: input\n      }]\n    };\n    const systemPrompt = {\n      role: 'user',\n      parts: [{\n        text: 'Bạn là một trợ lý ảo chuyên về du lịch tên là ChipChip. Chỉ hỏi 1 câu mỗi lượt. Chỉ trả lời về lịch trình, địa điểm, ngân sách du lịch. Nếu người dùng hỏi chủ đề khác, từ chối nhẹ nhàng. Thêm icon vào cuối câu.'\n      }]\n    };\n    const conversation = [systemPrompt, ...messages, userMessage];\n    setMessages(prev => [...prev, userMessage]);\n    setInput('');\n    setLoading(true);\n    try {\n      const reply = await askGemini(conversation);\n      const botMessage = {\n        role: 'model',\n        parts: [{\n          text: reply\n        }]\n      };\n      setMessages(prev => [...prev, botMessage]);\n\n      // 🚀 Trích xuất địa điểm từ nội dung AI\n      const extracted = extractLocations(reply);\n      if (extracted.length >= 2) setPlaces(extracted);\n    } catch (err) {\n      console.error(err);\n      setMessages(prev => [...prev, {\n        role: 'model',\n        parts: [{\n          text: '❌ Lỗi kết nối đến AI'\n        }]\n      }]);\n    } finally {\n      setLoading(false);\n    }\n  };\n  const extractLocations = text => {\n    // 🧠 Bạn có thể thay logic này bằng regex nâng cao hơn\n    const regex = /(?:tại|đến|ở)\\s([A-ZĐ][a-záàảãạâăéèêíìîóòôơúùưýỳỹđA-Z ]+)/g;\n    const results = [];\n    let match;\n    while ((match = regex.exec(text)) !== null) {\n      const place = match[1].trim();\n      if (place && !results.includes(place)) {\n        results.push(place);\n      }\n    }\n    return results;\n  };\n  const renderText = msg => {\n    var _msg$parts, _msg$parts$;\n    return ((_msg$parts = msg.parts) === null || _msg$parts === void 0 ? void 0 : (_msg$parts$ = _msg$parts[0]) === null || _msg$parts$ === void 0 ? void 0 : _msg$parts$.text) || msg.text || '';\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"p-4\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"h-[70vh] overflow-y-auto bg-gray-100 p-2 rounded\",\n      children: [messages.map((m, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `mb-2 ${m.role === 'user' ? 'text-right' : 'text-left'}`,\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"inline-block bg-white shadow p-2 rounded\",\n          children: renderText(m)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 73,\n          columnNumber: 13\n        }, this)\n      }, i, false, {\n        fileName: _jsxFileName,\n        lineNumber: 69,\n        columnNumber: 11\n      }, this)), loading && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-left mb-2\",\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"inline-block bg-white shadow p-2 rounded\",\n          children: \"\\u0110ang ngh\\u0129...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 80,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 7\n    }, this), places.length >= 2 && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mt-4\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"font-semibold mb-2\",\n        children: \"Tuy\\u1EBFn \\u0111\\u01B0\\u1EDDng g\\u1EE3i \\xFD\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(MapRoute, {\n        places: places\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mt-4 flex\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        className: \"flex-grow p-2 border rounded\",\n        value: input,\n        onChange: e => setInput(e.target.value),\n        onKeyDown: e => e.key === 'Enter' && handleSend(),\n        disabled: loading,\n        placeholder: \"H\\u1ECFi ChipChip v\\u1EC1 chuy\\u1EBFn \\u0111i c\\u1EE7a b\\u1EA1n...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleSend,\n        className: \"ml-2 px-4 py-2 bg-blue-500 text-white rounded\",\n        disabled: loading,\n        children: \"G\\u1EEDi\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 66,\n    columnNumber: 5\n  }, this);\n};\n_s(AssistantPage, \"qf9Mf/V8NBtr2cnNiFJyruQFe+M=\");\n_c = AssistantPage;\nexport default AssistantPage;\nvar _c;\n$RefreshReg$(_c, \"AssistantPage\");","map":{"version":3,"names":["React","useState","askGemini","MapRoute","jsxDEV","_jsxDEV","AssistantPage","_s","messages","setMessages","input","setInput","loading","setLoading","places","setPlaces","handleSend","trim","userMessage","role","parts","text","systemPrompt","conversation","prev","reply","botMessage","extracted","extractLocations","length","err","console","error","regex","results","match","exec","place","includes","push","renderText","msg","_msg$parts","_msg$parts$","className","children","map","m","i","fileName","_jsxFileName","lineNumber","columnNumber","value","onChange","e","target","onKeyDown","key","disabled","placeholder","onClick","_c","$RefreshReg$"],"sources":["D:/hackathon/CheapTrip/front-end/src/pages/AssistantPage.jsx"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { askGemini } from '../services/aiService';\r\nimport MapRoute from '../components/MapRoute';\r\n\r\nconst AssistantPage = () => {\r\n  const [messages, setMessages] = useState([]);\r\n  const [input, setInput] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [places, setPlaces] = useState([]);\r\n\r\n  const handleSend = async () => {\r\n    if (!input.trim() || loading) return;\r\n\r\n    const userMessage = { role: 'user', parts: [{ text: input }] };\r\n\r\n    const systemPrompt = {\r\n      role: 'user',\r\n      parts: [{\r\n        text: 'Bạn là một trợ lý ảo chuyên về du lịch tên là ChipChip. Chỉ hỏi 1 câu mỗi lượt. Chỉ trả lời về lịch trình, địa điểm, ngân sách du lịch. Nếu người dùng hỏi chủ đề khác, từ chối nhẹ nhàng. Thêm icon vào cuối câu.'\r\n      }]\r\n    };\r\n\r\n    const conversation = [systemPrompt, ...messages, userMessage];\r\n\r\n    setMessages((prev) => [...prev, userMessage]);\r\n    setInput('');\r\n    setLoading(true);\r\n\r\n    try {\r\n      const reply = await askGemini(conversation);\r\n      const botMessage = { role: 'model', parts: [{ text: reply }] };\r\n      setMessages((prev) => [...prev, botMessage]);\r\n\r\n      // 🚀 Trích xuất địa điểm từ nội dung AI\r\n      const extracted = extractLocations(reply);\r\n      if (extracted.length >= 2) setPlaces(extracted);\r\n    } catch (err) {\r\n      console.error(err);\r\n      setMessages((prev) => [...prev, {\r\n        role: 'model',\r\n        parts: [{ text: '❌ Lỗi kết nối đến AI' }]\r\n      }]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const extractLocations = (text) => {\r\n    // 🧠 Bạn có thể thay logic này bằng regex nâng cao hơn\r\n    const regex = /(?:tại|đến|ở)\\s([A-ZĐ][a-záàảãạâăéèêíìîóòôơúùưýỳỹđA-Z ]+)/g;\r\n    const results = [];\r\n    let match;\r\n    while ((match = regex.exec(text)) !== null) {\r\n      const place = match[1].trim();\r\n      if (place && !results.includes(place)) {\r\n        results.push(place);\r\n      }\r\n    }\r\n    return results;\r\n  };\r\n\r\n  const renderText = (msg) =>\r\n    msg.parts?.[0]?.text || msg.text || '';\r\n\r\n  return (\r\n    <div className=\"p-4\">\r\n      <div className=\"h-[70vh] overflow-y-auto bg-gray-100 p-2 rounded\">\r\n        {messages.map((m, i) => (\r\n          <div\r\n            key={i}\r\n            className={`mb-2 ${m.role === 'user' ? 'text-right' : 'text-left'}`}\r\n          >\r\n            <span className=\"inline-block bg-white shadow p-2 rounded\">\r\n              {renderText(m)}\r\n            </span>\r\n          </div>\r\n        ))}\r\n        {loading && (\r\n          <div className=\"text-left mb-2\">\r\n            <span className=\"inline-block bg-white shadow p-2 rounded\">\r\n              Đang nghĩ...\r\n            </span>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {places.length >= 2 && (\r\n        <div className=\"mt-4\">\r\n          <h2 className=\"font-semibold mb-2\">Tuyến đường gợi ý</h2>\r\n          <MapRoute places={places} />\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"mt-4 flex\">\r\n        <input\r\n          className=\"flex-grow p-2 border rounded\"\r\n          value={input}\r\n          onChange={(e) => setInput(e.target.value)}\r\n          onKeyDown={(e) => e.key === 'Enter' && handleSend()}\r\n          disabled={loading}\r\n          placeholder=\"Hỏi ChipChip về chuyến đi của bạn...\"\r\n        />\r\n        <button\r\n          onClick={handleSend}\r\n          className=\"ml-2 px-4 py-2 bg-blue-500 text-white rounded\"\r\n          disabled={loading}\r\n        >\r\n          Gửi\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AssistantPage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}